<h1 id="create-nuget-spec-file">Create Nuget Spec file</h1>
<h2 id="decide-what-will-be-packed">Decide what will be packed</h2>
<p>Follow the suggestions from <a href="https://docs.microsoft.com/en-us/nuget/create-packages/creating-a-package#deciding-which-assemblies-to-package">Microsoft Document</a>:</p>
<ol type="1">
<li>Pack the libraries that have dependencies between them as a Nuget Package</li>
<li>For those independent libraries, pack them to separate Nuget Packages</li>
</ol>
<h2 id="create-.nuspec-file">Create .nuspec file</h2>
<p>Go the the root path of target project,</p>
<pre><code>$ nuget spec</code></pre>
<p>This command will create a <code>&lt;&gt;.nuspec</code> file into the project. The file contains the following metadata:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode xml"><code class="sourceCode xml"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">&lt;?xml</span> version=&quot;1.0&quot;<span class="kw">?&gt;</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">&lt;package</span> <span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="kw">&lt;metadata&gt;</span></a>
<a class="sourceLine" id="cb2-4" title="4">    <span class="kw">&lt;id&gt;</span>$id$<span class="kw">&lt;/id&gt;</span></a>
<a class="sourceLine" id="cb2-5" title="5">    <span class="kw">&lt;version&gt;</span>$version$<span class="kw">&lt;/version&gt;</span></a>
<a class="sourceLine" id="cb2-6" title="6">    <span class="kw">&lt;title&gt;</span>$title$<span class="kw">&lt;/title&gt;</span></a>
<a class="sourceLine" id="cb2-7" title="7">    <span class="kw">&lt;authors&gt;</span>$author$<span class="kw">&lt;/authors&gt;</span></a>
<a class="sourceLine" id="cb2-8" title="8">    <span class="kw">&lt;owners&gt;</span>$author$<span class="kw">&lt;/owners&gt;</span></a>
<a class="sourceLine" id="cb2-9" title="9">    <span class="kw">&lt;licenseUrl&gt;</span>http://LICENSE_URL_HERE_OR_DELETE_THIS_LINE<span class="kw">&lt;/licenseUrl&gt;</span></a>
<a class="sourceLine" id="cb2-10" title="10">    <span class="kw">&lt;projectUrl&gt;</span>http://PROJECT_URL_HERE_OR_DELETE_THIS_LINE<span class="kw">&lt;/projectUrl&gt;</span></a>
<a class="sourceLine" id="cb2-11" title="11">    <span class="kw">&lt;iconUrl&gt;</span>http://ICON_URL_HERE_OR_DELETE_THIS_LINE<span class="kw">&lt;/iconUrl&gt;</span></a>
<a class="sourceLine" id="cb2-12" title="12">    <span class="kw">&lt;requireLicenseAcceptance&gt;</span>false<span class="kw">&lt;/requireLicenseAcceptance&gt;</span></a>
<a class="sourceLine" id="cb2-13" title="13">    <span class="kw">&lt;description&gt;</span>$description$<span class="kw">&lt;/description&gt;</span></a>
<a class="sourceLine" id="cb2-14" title="14">    <span class="kw">&lt;releaseNotes&gt;</span>Summary of changes made in this release of the package.<span class="kw">&lt;/releaseNotes&gt;</span></a>
<a class="sourceLine" id="cb2-15" title="15">    <span class="kw">&lt;copyright&gt;</span>Copyright 2019<span class="kw">&lt;/copyright&gt;</span></a>
<a class="sourceLine" id="cb2-16" title="16">    <span class="kw">&lt;tags&gt;</span>Tag1 Tag2<span class="kw">&lt;/tags&gt;</span></a>
<a class="sourceLine" id="cb2-17" title="17">  <span class="kw">&lt;/metadata&gt;</span></a>
<a class="sourceLine" id="cb2-18" title="18"><span class="kw">&lt;/package&gt;</span></a></code></pre></div>
<h2 id="update-.nuspec-file">Update .nuspec file</h2>
<p>We can update the right information on the .nuspec file or</p>
<ul>
<li>Use <a href="https://docs.microsoft.com/en-us/nuget/reference/nuspec#replacement-tokens">Replacement tokens</a></li>
<li>Pack cmd with <code>properties</code> argument</li>
</ul>
<h3 id="replacement-tokens">Replacement tokens</h3>
<h4 id="dotnet-framework">dotnet framework</h4>
<p>The supported Replacement tokens are as following,</p>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 50%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Token</th>
<th style="text-align: center;">Value source</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline"><em>i</em><em>d</em></span></td>
<td style="text-align: center;">Project file</td>
<td style="text-align: left;">AssemblyName (title) from the project file</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline"><em>v</em><em>e</em><em>r</em><em>s</em><em>i</em><em>o</em><em>n</em></span></td>
<td style="text-align: center;">AssemblyInfo</td>
<td style="text-align: left;">AssemblyInformationalVersion if defined, otherwise AssemblyVersion</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline"><em>a</em><em>u</em><em>t</em><em>h</em><em>o</em><em>r</em></span></td>
<td style="text-align: center;">AssemblyInfo</td>
<td style="text-align: left;">AssemblyCompany</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline"><em>t</em><em>i</em><em>t</em><em>l</em><em>e</em></span></td>
<td style="text-align: center;">AssemblyInfo</td>
<td style="text-align: left;">AssemblyTitle</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline"><em>d</em><em>e</em><em>s</em><em>c</em><em>r</em><em>i</em><em>p</em><em>t</em><em>i</em><em>o</em><em>n</em></span></td>
<td style="text-align: center;">AssemblyInfo</td>
<td style="text-align: left;">AssemblyDescription</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline"><em>c</em><em>o</em><em>p</em><em>y</em><em>r</em><em>i</em><em>g</em><em>h</em><em>t</em></span></td>
<td style="text-align: center;">AssemblyInfo</td>
<td style="text-align: left;">AssemblyCopyright</td>
</tr>
</tbody>
</table>
<p>We can set the AssemblyInfo in Visual Studio,</p>
<p><img src="assets/001.png" /></p>
<h4 id="dotnet-core">dotnet core</h4>
<p>Same as the ones of dotnet framework except <code>$authors$</code></p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Token</th>
<th style="text-align: center;">Value source</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline"><em>a</em><em>u</em><em>t</em><em>h</em><em>o</em><em>r</em><em>s</em></span></td>
<td style="text-align: center;">AssemblyInfo</td>
<td style="text-align: left;">AssemblyCompany</td>
</tr>
</tbody>
</table>
<p>In dotnet core project, we can write/find the above informations in project file or in Visual Studio <strong>[Project properties]</strong>-&gt;<strong>[Package]</strong> as following,</p>
<p><img src="assets/002.png" /></p>
<hr />
<p>This is an example for using <a href="https://docs.microsoft.com/en-us/nuget/reference/nuspec#replacement-tokens">Replacement tokens</a> in .nuspec file for dotnet core class library project,</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode xml"><code class="sourceCode xml"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">&lt;?xml</span> version=&quot;1.0&quot;<span class="kw">?&gt;</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">&lt;package</span> <span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb3-3" title="3">  <span class="kw">&lt;metadata&gt;</span></a>
<a class="sourceLine" id="cb3-4" title="4">    <span class="kw">&lt;id&gt;</span>$id$<span class="kw">&lt;/id&gt;</span></a>
<a class="sourceLine" id="cb3-5" title="5">    <span class="kw">&lt;version&gt;</span>$version$<span class="kw">&lt;/version&gt;</span></a>
<a class="sourceLine" id="cb3-6" title="6">    <span class="kw">&lt;title&gt;</span>$title$<span class="kw">&lt;/title&gt;</span></a>
<a class="sourceLine" id="cb3-7" title="7">    <span class="kw">&lt;authors&gt;</span>$authors$<span class="kw">&lt;/authors&gt;</span></a>
<a class="sourceLine" id="cb3-8" title="8">    <span class="kw">&lt;owners&gt;</span>$authors$<span class="kw">&lt;/owners&gt;</span></a>
<a class="sourceLine" id="cb3-9" title="9">    <span class="co">&lt;!--&lt;license type=&quot;file&quot;&gt;LICENSE&lt;/license&gt;--&gt;</span></a>
<a class="sourceLine" id="cb3-10" title="10">    <span class="kw">&lt;license</span><span class="ot"> type=</span><span class="st">&quot;expression&quot;</span><span class="kw">&gt;</span>MIT<span class="kw">&lt;/license&gt;</span></a>
<a class="sourceLine" id="cb3-11" title="11">    <span class="kw">&lt;projectUrl&gt;</span>https://github.com/KarateJB/JB.Infra<span class="kw">&lt;/projectUrl&gt;</span></a>
<a class="sourceLine" id="cb3-12" title="12">    <span class="kw">&lt;requireLicenseAcceptance&gt;</span>false<span class="kw">&lt;/requireLicenseAcceptance&gt;</span></a>
<a class="sourceLine" id="cb3-13" title="13">    <span class="kw">&lt;description&gt;</span>$description$<span class="kw">&lt;/description&gt;</span></a>
<a class="sourceLine" id="cb3-14" title="14">    <span class="kw">&lt;releaseNotes&gt;</span></a>
<a class="sourceLine" id="cb3-15" title="15">      v1.0.0.0</a>
<a class="sourceLine" id="cb3-16" title="16">      Awesome package(?)</a>
<a class="sourceLine" id="cb3-17" title="17">    <span class="kw">&lt;/releaseNotes&gt;</span></a>
<a class="sourceLine" id="cb3-18" title="18">    <span class="kw">&lt;copyright&gt;</span>$copyright$<span class="kw">&lt;/copyright&gt;</span></a>
<a class="sourceLine" id="cb3-19" title="19">    <span class="kw">&lt;tags&gt;</span>dotnetcore util ef<span class="kw">&lt;/tags&gt;</span></a>
<a class="sourceLine" id="cb3-20" title="20">  <span class="kw">&lt;/metadata&gt;</span></a>
<a class="sourceLine" id="cb3-21" title="21"><span class="kw">&lt;/package&gt;</span></a></code></pre></div>
<blockquote>
<p><strong>license</strong> tag allows the pattern:<code>&lt;license type="expression | file" /&gt;</code> <br /> ex. <br /> <code>&lt;license type="expression"&gt;Apache-2.0&lt;/license&gt;</code> <br /> <code>&lt;license type="file"&gt;LICENSE.txt&lt;/license&gt;</code> (Supported format: md, txt) <br /><br /> Reference: <a href="https://github.com/NuGet/Home/wiki/Packaging-License-within-the-nupkg">Packaging License within the nupkg</a></p>
</blockquote>
<h3 id="pack-cmd-with-properties-argument">Pack cmd with properties argument</h3>
<pre><code>$ nuget pack -properties &lt;name&gt;=&lt;value&gt;;&lt;name&gt;=&lt;value&gt;</code></pre>
<p>For example,</p>
<pre><code>$ nuget pack -properties tags=&quot;dotnetcore util ef&quot;;description=&quot;My nuget package&quot;</code></pre>
<h2 id="pack-the-librarylibraries">Pack the library/libraries</h2>
<pre><code>$ nuget pack &lt;nuspec_path | project_path&gt; [options] [-Properties ...] </code></pre>
<p>For more options. see <a href="https://docs.microsoft.com/en-us/nuget/tools/cli-ref-pack#options">pack command (NuGet CLI)</a></p>
<p>For example,</p>
<pre><code>$ nuget pack ../xxx/xxx.csproj</code></pre>
<blockquote>
<p>Notice that to pack another project which has no <code>.nuspec</code> file will have some bugs, like the <code>Author</code> property will be set to the value of <code>Company</code> from Project file. <br /> Thus it’s recommanded to pack the project which has local <code>.nuspec</code> file.</p>
</blockquote>
<p>Or the most useful case is set the configuration and version:</p>
<pre><code>$ nuget pack xxx.csproj -Properties Configuration=Release -Version 0.0.0.1</code></pre>
<h3 id="demo">Demo</h3>
<pre><code>$ dotnet build --configuration release
$ nuget pack JB.Infra.Util.csproj -Properties Configuration=Release -Version 0.0.0.1</code></pre>
<p>Result:</p>
<p><img src="assets/003.png" /></p>
<h2 id="set-dependencies-information">Set Dependencies information</h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode xml"><code class="sourceCode xml"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">&lt;?xml</span> version=&quot;1.0&quot;<span class="kw">?&gt;</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="kw">&lt;package</span> <span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb10-3" title="3">  <span class="kw">&lt;metadata&gt;</span></a>
<a class="sourceLine" id="cb10-4" title="4">    <span class="co">&lt;!-- skip --&gt;</span></a>
<a class="sourceLine" id="cb10-5" title="5">    <span class="kw">&lt;dependencies&gt;</span></a>
<a class="sourceLine" id="cb10-6" title="6">      <span class="kw">&lt;dependency</span><span class="ot"> id=</span><span class="st">&quot;Microsoft.Extensions.Caching.Memory&quot;</span><span class="ot"> version=</span><span class="st">&quot;2.2.0&quot;</span> <span class="kw">/&gt;</span></a>
<a class="sourceLine" id="cb10-7" title="7">      <span class="kw">&lt;dependency</span><span class="ot"> id=</span><span class="st">&quot;Newtonsoft.Json&quot;</span><span class="ot"> version=</span><span class="st">&quot;11.0.2&quot;</span> <span class="kw">/&gt;</span></a>
<a class="sourceLine" id="cb10-8" title="8">    <span class="kw">&lt;/dependencies&gt;</span></a>
<a class="sourceLine" id="cb10-9" title="9">  <span class="kw">&lt;/metadata&gt;</span></a>
<a class="sourceLine" id="cb10-10" title="10"><span class="kw">&lt;/package&gt;</span></a></code></pre></div>
<h2 id="including-license-file">Including License file</h2>
<p>As mentioned above, we can use the file type as <code>&lt;license type="file"&gt;</code> in .nuspec file. But we have to define the file in the file list like following.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode xml"><code class="sourceCode xml"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">&lt;?xml</span> version=&quot;1.0&quot;<span class="kw">?&gt;</span></a>
<a class="sourceLine" id="cb11-2" title="2"><span class="kw">&lt;package</span> <span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb11-3" title="3">  <span class="kw">&lt;metadata&gt;</span></a>
<a class="sourceLine" id="cb11-4" title="4">    <span class="co">&lt;!-- skip --&gt;</span></a>
<a class="sourceLine" id="cb11-5" title="5">    <span class="kw">&lt;license</span><span class="ot"> type=</span><span class="st">&quot;file&quot;</span><span class="kw">&gt;</span>LICENSE.txt<span class="kw">&lt;/license&gt;</span></a>
<a class="sourceLine" id="cb11-6" title="6">  <span class="kw">&lt;/metadata&gt;</span></a>
<a class="sourceLine" id="cb11-7" title="7">  <span class="kw">&lt;files&gt;</span></a>
<a class="sourceLine" id="cb11-8" title="8">    <span class="kw">&lt;file</span><span class="ot"> src=</span><span class="st">&quot;LICENSE.txt&quot;</span><span class="ot"> target=</span><span class="st">&quot;&quot;</span> <span class="kw">/&gt;</span></a>
<a class="sourceLine" id="cb11-9" title="9">  <span class="kw">&lt;/files&gt;</span></a>
<a class="sourceLine" id="cb11-10" title="10"><span class="kw">&lt;/package&gt;</span></a></code></pre></div>
<p>Which will results in the following information on Nuget package,</p>
<p><img src="assets/004.png" /></p>
<h2 id="including-assembly-files">Including assembly files</h2>
<p>Specify the file list in <strong>.nuspec</strong> to include other <code>.dll</code>/<code>.pdb</code>/… files into the package.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode xml"><code class="sourceCode xml"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">&lt;?xml</span> version=&quot;1.0&quot;<span class="kw">?&gt;</span></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="kw">&lt;package</span> <span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb12-3" title="3">  <span class="kw">&lt;metadata&gt;</span></a>
<a class="sourceLine" id="cb12-4" title="4">    <span class="co">&lt;!-- skip --&gt;</span></a>
<a class="sourceLine" id="cb12-5" title="5">  <span class="kw">&lt;/metadata&gt;</span></a>
<a class="sourceLine" id="cb12-6" title="6">  <span class="kw">&lt;files&gt;</span></a>
<a class="sourceLine" id="cb12-7" title="7">    <span class="kw">&lt;file</span><span class="ot"> src=</span><span class="st">&quot;LICENSE.txt&quot;</span><span class="ot"> target=</span><span class="st">&quot;&quot;</span> <span class="kw">/&gt;</span></a>
<a class="sourceLine" id="cb12-8" title="8">    <span class="kw">&lt;file</span><span class="ot"> src=</span><span class="st">&quot;..\JB.Infra.Util.EF\bin\$configuration$\netstandard2.0\JB.Infra.Util.EF.dll&quot;</span><span class="ot"> target=</span><span class="st">&quot;lib\netstandard2.0\JB.Infra.Util.EF.dll&quot;</span> <span class="kw">/&gt;</span></a>
<a class="sourceLine" id="cb12-9" title="9">    <span class="kw">&lt;file</span><span class="ot"> src=</span><span class="st">&quot;..\JB.Infra.Util.EF\bin\$configuration$\netstandard2.0\JB.Infra.Util.EF.xml&quot;</span><span class="ot"> target=</span><span class="st">&quot;lib\netstandard2.0\JB.Infra.Util.EF.xml&quot;</span> <span class="kw">/&gt;</span></a>
<a class="sourceLine" id="cb12-10" title="10">    <span class="kw">&lt;file</span><span class="ot"> src=</span><span class="st">&quot;..\JB.Infra.Util.Logging\bin\$configuration$\netstandard2.0\JB.Infra.Util.Logging.dll&quot;</span><span class="ot"> target=</span><span class="st">&quot;lib\netstandard2.0\JB.Infra.Util.Logging.dll&quot;</span> <span class="kw">/&gt;</span></a>
<a class="sourceLine" id="cb12-11" title="11">    <span class="kw">&lt;file</span><span class="ot"> src=</span><span class="st">&quot;..\JB.Infra.Util.Logging\bin\$configuration$\netstandard2.0\JB.Infra.Util.Logging.xml&quot;</span><span class="ot"> target=</span><span class="st">&quot;lib\netstandard2.0\JB.Infra.Util.Logging.xml&quot;</span> <span class="kw">/&gt;</span></a>
<a class="sourceLine" id="cb12-12" title="12">  <span class="kw">&lt;/files&gt;</span></a>
<a class="sourceLine" id="cb12-13" title="13"><span class="kw">&lt;/package&gt;</span></a></code></pre></div>
<h2 id="including-content-files">Including content files</h2>
<p>Sometimes we would like a content file to be installed into the project which has installed our Nuget package. For example, a <code>NLog.config</code> shall be installed as a content file when the Logging package is installed.</p>
<p>Specify the key target path: <code>contentFiles\any\any\&lt;ContentFile&gt;</code> like following, (DO NOT remove or modify <code>contentFiles\any\any\</code>!)</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode xml"><code class="sourceCode xml"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">&lt;?xml</span> version=&quot;1.0&quot;<span class="kw">?&gt;</span></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw">&lt;package</span> <span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb13-3" title="3">  <span class="kw">&lt;metadata&gt;</span></a>
<a class="sourceLine" id="cb13-4" title="4">    <span class="co">&lt;!-- skip --&gt;</span></a>
<a class="sourceLine" id="cb13-5" title="5">  <span class="kw">&lt;/metadata&gt;</span></a>
<a class="sourceLine" id="cb13-6" title="6">  <span class="kw">&lt;files&gt;</span></a>
<a class="sourceLine" id="cb13-7" title="7">    <span class="kw">&lt;file</span><span class="ot"> src=</span><span class="st">&quot;..\JB.Infra.Util.Logging\NLog.config&quot;</span><span class="ot"> target=</span><span class="st">&quot;contentFiles\any\any\NLog.config&quot;</span><span class="kw">/&gt;</span></a>
<a class="sourceLine" id="cb13-8" title="8">  <span class="kw">&lt;/files&gt;</span></a>
<a class="sourceLine" id="cb13-9" title="9"><span class="kw">&lt;/package&gt;</span></a></code></pre></div>
<p>and the content file will be placed under the root directory of project:</p>
<p><img src="assets/005.png" /></p>
<hr />
<pre><code>dotnet list package --source MyNugetServer
dotnet add package JB.Infra.Util --version 0.0.0.50 --source MyNugetServer
nuget sources remove -name MyNugetServer

nuget sources add -name &quot;MyNugetServer&quot; -source http://xxxxxxxx2:8080/nuget -username xxxx -password xxxx



nuget sources add -name &quot;MyNugetServer&quot; -source http://xxxxx:8080/nuget -username xxxx -password xxx -configfile %AppData%\NuGet\Nuget.config
//C:\Users\jb\AppData\Roaming\NuGet

nuget list -Source MyNugetServer
nuget source list
nuget delete JB.Infra.Util 0.0.0.30 -Source MyNugetServer -apikey xxxxxxx</code></pre>
